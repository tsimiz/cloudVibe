<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Cloud Island POC</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background: #cce7f3;
      touch-action: none;
    }
    canvas {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
    }
    #overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.5);
      color: #fff;
      font-family: monospace;
      font-size: 16px;
      text-align: center;
      z-index: 10;
      opacity: 0;
      animation: fadeIn 1s forwards;
    }
    #overlay.fade-out {
      animation: fadeOut 0.5s forwards;
    }
    #overlay button {
      margin-top: 20px;
      font-size: 14px;
      padding: 10px 20px;
      background: #fff;
      color: #000;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      font-family: monospace;
      font-size: 12px;
      color: #000;
      background: rgba(255,255,255,0.7);
      padding: 6px;
      border-radius: 4px;
      z-index: 5;
    }
    #level-display {
      position: absolute;
      top: 10px;
      right: 10px;
      font-family: monospace;
      font-size: 14px;
      font-weight: bold;
      color: #000;
      background: rgba(255,255,255,0.8);
      padding: 8px 12px;
      border-radius: 4px;
      z-index: 5;
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }
    @keyframes fadeOut {
      to { opacity: 0; }
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="hud">Azure Credits: 0</div>
  <div id="level-display">Level 1</div>
  <div id="overlay">
    <div id="message">VIBE CLOUD ISLAND</div>
    <button id="overlay-button" onclick="startGame()">Start</button>
  </div>
  <audio id="collectSound" preload="none"></audio>
  <script>
    const canvas = document.getElementById('gameCanvas');
canvas.setAttribute('tabindex', '0');
canvas.style.outline = 'none';
    const ctx = canvas.getContext('2d');
    const overlay = document.getElementById('overlay');
    const message = document.getElementById('message');
    const overlayButton = document.getElementById('overlay-button');
    const hud = document.getElementById('hud');
    const levelDisplay = document.getElementById('level-display');
    const collectSound = document.getElementById('collectSound');

    // Remove external image dependencies - use simple rectangles instead

    let width, height;
    let gameRunning = false;
    let currentLevel = 1;
    const maxLevel = 5;

    const collected = {
      credits: 0
    };

    const particles = [];

    // Level configurations with different colors and layouts
    const levelConfigs = {
      1: {
        backgroundColor: '#cce7f3',
        platformColor: '#aad8d3',
        playerColor: '#ffb6b9',
        cloudColor: '#f0f8ff',
        platforms: [
          { x: 0, y: 400, width: 800, height: 40 },
          { x: 300, y: 320, width: 120, height: 20 },
          { x: 500, y: 250, width: 100, height: 20 },
          { x: 700, y: 180, width: 120, height: 20 },
          { x: 900, y: 300, width: 150, height: 20 },
          { x: 1120, y: 325, width: 100, height: 20 },
          { x: 1300, y: 350, width: 120, height: 20 },
          { x: 1500, y: 280, width: 120, height: 20 }
        ],
        collectibles: [
          { x: 330, y: 290, collected: false, type: 'credit' },
          { x: 530, y: 220, collected: false, type: 'credit' },
          { x: 730, y: 150, collected: false, type: 'credit' },
          { x: 1150, y: 295, collected: false, type: 'credit' }
        ],
        gate: { x: 1560, y: 240, width: 20, height: 40 }
      },
      2: {
        backgroundColor: '#ffeaa7',
        platformColor: '#fdcb6e',
        playerColor: '#e17055',
        cloudColor: '#ffffff',
        platforms: [
          { x: 0, y: 400, width: 600, height: 40 },
          { x: 200, y: 340, width: 100, height: 20 },
          { x: 380, y: 280, width: 100, height: 20 },
          { x: 560, y: 220, width: 100, height: 20 },
          { x: 740, y: 160, width: 100, height: 20 },
          { x: 920, y: 220, width: 120, height: 20 },
          { x: 1120, y: 280, width: 100, height: 20 },
          { x: 1300, y: 340, width: 150, height: 20 }
        ],
        collectibles: [
          { x: 230, y: 310, collected: false, type: 'credit' },
          { x: 410, y: 250, collected: false, type: 'credit' },
          { x: 590, y: 190, collected: false, type: 'credit' },
          { x: 950, y: 190, collected: false, type: 'credit' }
        ],
        gate: { x: 1400, y: 300, width: 20, height: 40 }
      },
      3: {
        backgroundColor: '#d1f2eb',
        platformColor: '#58d68d',
        playerColor: '#2e86ab',
        cloudColor: '#a8e6cf',
        platforms: [
          { x: 0, y: 400, width: 500, height: 40 },
          { x: 150, y: 320, width: 80, height: 20 },
          { x: 300, y: 260, width: 80, height: 20 },
          { x: 450, y: 200, width: 80, height: 20 },
          { x: 600, y: 140, width: 80, height: 20 },
          { x: 750, y: 200, width: 80, height: 20 },
          { x: 900, y: 260, width: 80, height: 20 },
          { x: 1050, y: 200, width: 80, height: 20 },
          { x: 1200, y: 320, width: 200, height: 20 }
        ],
        collectibles: [
          { x: 180, y: 290, collected: false, type: 'credit' },
          { x: 330, y: 230, collected: false, type: 'credit' },
          { x: 480, y: 170, collected: false, type: 'credit' },
          { x: 780, y: 170, collected: false, type: 'credit' },
          { x: 1080, y: 170, collected: false, type: 'credit' }
        ],
        gate: { x: 1360, y: 280, width: 20, height: 40 }
      },
      4: {
        backgroundColor: '#fab1a0',
        platformColor: '#e17055',
        playerColor: '#74b9ff',
        cloudColor: '#ffeaa7',
        platforms: [
          { x: 0, y: 400, width: 400, height: 40 },
          { x: 100, y: 350, width: 60, height: 20 },
          { x: 220, y: 300, width: 60, height: 20 },
          { x: 340, y: 250, width: 60, height: 20 },
          { x: 460, y: 200, width: 60, height: 20 },
          { x: 580, y: 150, width: 60, height: 20 },
          { x: 700, y: 100, width: 60, height: 20 },
          { x: 820, y: 150, width: 60, height: 20 },
          { x: 940, y: 200, width: 60, height: 20 },
          { x: 1060, y: 250, width: 60, height: 20 },
          { x: 1180, y: 300, width: 60, height: 20 },
          { x: 1300, y: 350, width: 200, height: 20 }
        ],
        collectibles: [
          { x: 130, y: 320, collected: false, type: 'credit' },
          { x: 250, y: 270, collected: false, type: 'credit' },
          { x: 370, y: 220, collected: false, type: 'credit' },
          { x: 610, y: 120, collected: false, type: 'credit' },
          { x: 730, y: 70, collected: false, type: 'credit' },
          { x: 970, y: 170, collected: false, type: 'credit' }
        ],
        gate: { x: 1460, y: 310, width: 20, height: 40 }
      },
      5: {
        backgroundColor: '#a29bfe',
        platformColor: '#6c5ce7',
        playerColor: '#fd79a8',
        cloudColor: '#e84393',
        platforms: [
          { x: 0, y: 400, width: 300, height: 40 },
          { x: 80, y: 360, width: 50, height: 20 },
          { x: 180, y: 320, width: 50, height: 20 },
          { x: 280, y: 280, width: 50, height: 20 },
          { x: 380, y: 240, width: 50, height: 20 },
          { x: 480, y: 200, width: 50, height: 20 },
          { x: 580, y: 160, width: 50, height: 20 },
          { x: 680, y: 120, width: 50, height: 20 },
          { x: 780, y: 80, width: 50, height: 20 },
          { x: 880, y: 120, width: 50, height: 20 },
          { x: 980, y: 160, width: 50, height: 20 },
          { x: 1080, y: 200, width: 50, height: 20 },
          { x: 1180, y: 240, width: 50, height: 20 },
          { x: 1280, y: 280, width: 50, height: 20 },
          { x: 1380, y: 320, width: 50, height: 20 },
          { x: 1480, y: 360, width: 200, height: 20 }
        ],
        collectibles: [
          { x: 110, y: 330, collected: false, type: 'credit' },
          { x: 210, y: 290, collected: false, type: 'credit' },
          { x: 310, y: 250, collected: false, type: 'credit' },
          { x: 510, y: 170, collected: false, type: 'credit' },
          { x: 710, y: 90, collected: false, type: 'credit' },
          { x: 810, y: 50, collected: false, type: 'credit' },
          { x: 1010, y: 130, collected: false, type: 'credit' }
        ],
        gate: { x: 1640, y: 320, width: 20, height: 40 }
      }
    };

    function resizeCanvas() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    const player = {
      x: 100,
      y: 100,
      vx: 0,
      vy: 0,
      width: 32,
      height: 32,
      grounded: false
    };

    const gravity = 0.5;
    const moveSpeed = 3;
    const jumpForce = -10;

    let cameraX = 0;

    const clouds = [
      { x: 0, y: 50, width: 200, height: 60 },
      { x: 400, y: 100, width: 180, height: 50 },
      { x: 900, y: 70, width: 220, height: 70 },
      { x: 1300, y: 90, width: 160, height: 55 }
    ];

    // Current level platforms and collectibles (will be updated based on currentLevel)
    let platforms = [];
    let collectibles = [];
    let gate = null;
    let gateVisible = false;

    let keys = { left: false, right: false, up: false };

    canvas.addEventListener('touchstart', (e) => {
      const touch = e.touches[0];
      if (touch.clientX < width / 3) keys.left = true;
      else if (touch.clientX > (2 * width) / 3) keys.right = true;
      else keys.up = true;
    });
    canvas.addEventListener('touchend', () => {
      keys.left = false;
      keys.right = false;
      keys.up = false;
    });

    // Add desktop keyboard support
    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft' || e.key === 'a') {
        keys.left = true;
        e.preventDefault();
      }
      if (e.key === 'ArrowRight' || e.key === 'd') {
        keys.right = true;
        e.preventDefault();
      }
      if (e.key === 'ArrowUp' || e.key === 'w' || e.key === ' ') {
        keys.up = true;
        e.preventDefault();
      }
    });
    window.addEventListener('keyup', (e) => {
      if (e.key === 'ArrowLeft' || e.key === 'a') {
        keys.left = false;
        e.preventDefault();
      }
      if (e.key === 'ArrowRight' || e.key === 'd') {
        keys.right = false;
        e.preventDefault();
      }
      if (e.key === 'ArrowUp' || e.key === 'w' || e.key === ' ') {
        keys.up = false;
        e.preventDefault();
      }
    });

    function updateHUD() {
      hud.innerText = `Azure Credits: ${collected.credits}`;
    }

    function updateLevelDisplay() {
      levelDisplay.innerText = `Level ${currentLevel}`;
    }

    function loadLevel(level) {
      const config = levelConfigs[level];
      if (!config) return;
      
      platforms = [...config.platforms];
      collectibles = config.collectibles.map(c => ({ ...c, collected: false }));
      gate = { ...config.gate };
      gateVisible = false;
      
      // Update background color
      document.body.style.background = config.backgroundColor;
      
      updateLevelDisplay();
    }

    function checkLevelComplete() {
      const totalCollectibles = collectibles.length;
      const collectedCount = collectibles.filter(c => c.collected).length;
      
      if (collectedCount === totalCollectibles) {
        // Show the gate when all collectibles are collected
        gateVisible = true;
      }
    }

    function createParticles(x, y, color) {
      for (let i = 0; i < 10; i++) {
        particles.push({
          x: x + 8,
          y: y + 8,
          vx: (Math.random() - 0.5) * 2,
          vy: (Math.random() - 0.5) * 2,
          life: 30,
          color: color
        });
      }
    }

    function update() {
      if (keys.left) player.vx = -moveSpeed;
      else if (keys.right) player.vx = moveSpeed;
      else player.vx = 0;

      if (keys.up && player.grounded) {
        player.vy = jumpForce;
        player.grounded = false;
      }

      player.vy += gravity;
      player.x += player.vx;
      player.y += player.vy;

      player.grounded = false;
      for (const p of platforms) {
        if (
          player.x < p.x + p.width &&
          player.x + player.width > p.x &&
          player.y < p.y + p.height &&
          player.y + player.height > p.y
        ) {
          if (player.vy > 0) {
            player.y = p.y - player.height;
            player.vy = 0;
            player.grounded = true;
          }
        }
      }

      for (const c of collectibles) {
        if (!c.collected &&
            player.x < c.x + 16 &&
            player.x + player.width > c.x &&
            player.y < c.y + 16 &&
            player.y + player.height > c.y) {
          c.collected = true;
          collected.credits++;
          updateHUD();
          // Audio removed for compatibility
          createParticles(c.x, c.y, '#fff');
          checkLevelComplete();
        }
      }

      // Check gate collision
      if (gateVisible && gate &&
          player.x < gate.x + gate.width &&
          player.x + player.width > gate.x &&
          player.y < gate.y + gate.height &&
          player.y + player.height > gate.y) {
        
        if (currentLevel < maxLevel) {
          // Advance to next level
          currentLevel++;
          resetPlayer();
          loadLevel(currentLevel);
          
          // Show level complete message briefly
          message.innerText = `Level ${currentLevel - 1} Complete! Starting Level ${currentLevel} - Azure Credits: ${collected.credits}`;
          overlay.style.display = 'flex';
          overlay.classList.remove('fade-out');
          
          setTimeout(() => {
            overlay.classList.add('fade-out');
            setTimeout(() => {
              overlay.style.display = 'none';
              gameRunning = true;
            }, 500);
          }, 2000);
        } else {
          // Game complete!
          gameRunning = false;
          message.innerText = '🏆 All levels completed! You are an Azure master! 🏆';
          overlayButton.innerText = 'Play Again';
          overlay.classList.remove('fade-out');
          overlay.style.display = 'flex';
        }
      }

      for (const p of particles) {
        p.x += p.vx;
        p.y += p.vy;
        p.life--;
      }

      while (particles.length > 0 && particles[0].life <= 0) {
        particles.shift();
      }

      if (player.y > height) {
        endGame();
      }

      cameraX = player.x - width / 2 + player.width / 2;
    }

    function draw() {
      const config = levelConfigs[currentLevel];
      ctx.clearRect(0, 0, width, height);

      ctx.save();
      ctx.translate(-cameraX * 0.5, 0);
      ctx.fillStyle = config.cloudColor;
      for (const c of clouds) {
        ctx.beginPath();
        ctx.ellipse(c.x, c.y, c.width / 2, c.height / 2, 0, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.restore();

      ctx.save();
      ctx.translate(-cameraX, 0);

      ctx.fillStyle = config.platformColor;
      for (const p of platforms) {
        ctx.fillRect(p.x, p.y, p.width, p.height);
      }

      ctx.fillStyle = config.playerColor;
      ctx.fillRect(player.x, player.y, player.width, player.height);

      // Draw collectibles as Azure credits
      for (const c of collectibles) {
        if (!c.collected) {
          // Draw Azure blue background
          ctx.fillStyle = '#0078d4';
          ctx.fillRect(c.x, c.y, 16, 16);
          
          // Add $ symbol for credits
          ctx.fillStyle = '#fff';
          ctx.font = 'bold 12px monospace';
          ctx.fillText('$', c.x + 4, c.y + 12);
        }
      }

      // Draw gate if visible
      if (gateVisible && gate) {
        ctx.fillStyle = '#ffd700'; // Gold color for the gate
        ctx.fillRect(gate.x, gate.y, gate.width, gate.height);
        
        // Add gate decoration
        ctx.fillStyle = '#000';
        ctx.font = '12px monospace';
        ctx.fillText('🚪', gate.x - 5, gate.y - 5);
        
        // Add "GATE" text below
        ctx.fillStyle = '#000';
        ctx.font = '8px monospace';
        ctx.fillText('GATE', gate.x - 5, gate.y + gate.height + 12);
      }

      for (const p of particles) {
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.life / 30;
        ctx.beginPath();
        ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
      }

      ctx.restore();
    }

    function gameLoop() {
      if (!gameRunning) return;
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    function startGame() {
      // Update message to show current credits
      message.innerText = `Level ${currentLevel} - Azure Credits: ${collected.credits}`;
      
      overlay.classList.add('fade-out');
      setTimeout(() => {
        overlay.style.display = 'none';
        gameRunning = true;
        canvas.focus(); // Ensure canvas has focus when game starts
        resetGame();
        gameLoop(); // Start the game loop directly
      }, 500);
    }

    function endGame() {
      gameRunning = false;
      message.innerText = 'GAME OVER';
      overlayButton.innerText = 'Restart';
      overlay.classList.remove('fade-out');
      overlay.style.display = 'flex';
    }

    function resetPlayer() {
      player.x = 100;
      player.y = 400 - player.height;
      player.vx = 0;
      player.vy = 0;
      // Don't reset credits - keep them across levels
      particles.length = 0;
      updateHUD();
      for (const c of collectibles) {
        c.collected = false;
      }
    }

    function resetGame() {
      currentLevel = 1;
      collected.credits = 0; // Reset credits only when starting a new game
      loadLevel(currentLevel);
      resetPlayer();
    }
  
    window.addEventListener('load', () => {
      loadLevel(currentLevel); // Initialize first level
      overlay.style.opacity = '1';
      canvas.focus();
      window.startGame = startGame;
    });
  </script>
</body>
</html>
